package fireback

/*
*	Generated by fireback 1.2.2
*	Written by Ali Torabi.
*	Checkout the repository for licenses and contribution: https://github.com/torabian/fireback
 */
import (
	"github.com/gin-gonic/gin"
	"github.com/pion/webrtc/v3"
	"github.com/urfave/cli"
)

// using shared actions here
var MousePositionCaptureSecurityModel *SecurityModel = nil

type MousePositionCaptureActionReqDto struct {
	X       int                        `json:"x" xml:"x" yaml:"x"        `
	Y       int                        `json:"y" xml:"y" yaml:"y"        `
	Offer   *webrtc.SessionDescription `json:"offer" xml:"offer" yaml:"offer"    gorm:"foreignKey:OfferId;references:UniqueId"      `
	OfferId String                     `json:"offerId" yaml:"offerId" xml:"offerId"  `
}

func (x *MousePositionCaptureActionReqDto) RootObjectName() string {
	return "Fireback"
}

var MousePositionCaptureCommonCliFlagsOptional = []cli.Flag{
	&cli.IntFlag{
		Name:     "x",
		Required: false,
		Usage:    `x (int)`,
	},
	&cli.IntFlag{
		Name:     "y",
		Required: false,
		Usage:    `y (int)`,
	},
	&cli.StringFlag{
		Name:     "offer-id",
		Required: false,
		Usage:    `offer (one)`,
	},
}

func MousePositionCaptureActionReqValidator(dto *MousePositionCaptureActionReqDto) *IError {
	err := CommonStructValidatorPointer(dto, false)
	return err
}
func CastMousePositionCaptureFromCli(c *cli.Context) *MousePositionCaptureActionReqDto {
	template := &MousePositionCaptureActionReqDto{}
	if c.IsSet("x") {
		value := c.Int("x")
		template.X = value
	}
	if c.IsSet("y") {
		value := c.Int("y")
		template.Y = value
	}
	if c.IsSet("offer-id") {
		template.OfferId = NewStringAutoNull(c.String("offer-id"))
	}
	return template
}

type MousePositionCaptureActionResDto struct {
	SessionDescription   *webrtc.SessionDescription `json:"sessionDescription" xml:"sessionDescription" yaml:"sessionDescription"    gorm:"foreignKey:SessionDescriptionId;references:UniqueId"      `
	SessionDescriptionId String                     `json:"sessionDescriptionId" yaml:"sessionDescriptionId" xml:"sessionDescriptionId"  `
}

func (x *MousePositionCaptureActionResDto) RootObjectName() string {
	return "Fireback"
}

type mousePositionCaptureActionImpSig func(
	req *MousePositionCaptureActionReqDto,
	q QueryDSL) (*MousePositionCaptureActionResDto,
	*IError,
)

var MousePositionCaptureActionImp mousePositionCaptureActionImpSig

func MousePositionCaptureActionFn(
	req *MousePositionCaptureActionReqDto,
	q QueryDSL,
) (
	*MousePositionCaptureActionResDto,
	*IError,
) {
	if MousePositionCaptureActionImp == nil {
		return nil, nil
	}
	return MousePositionCaptureActionImp(req, q)
}

var MousePositionCaptureActionCmd cli.Command = cli.Command{
	Name:  "mouse-position-capture",
	Usage: ``,
	Flags: MousePositionCaptureCommonCliFlagsOptional,
	Action: func(c *cli.Context) {
		query := CommonCliQueryDSLBuilderAuthorize(c, MousePositionCaptureSecurityModel)
		dto := CastMousePositionCaptureFromCli(c)
		result, err := MousePositionCaptureActionFn(dto, query)
		HandleActionInCli(c, result, err, map[string]map[string]string{})
	},
}
var EventBusSubscriptionSecurityModel = &SecurityModel{
	ActionRequires:  []PermissionInfo{},
	ResolveStrategy: "user",
}
var EventBusSubscriptionActionImp = DefaultEmptyReactiveAction

// Reactive action does not have that
var EventBusSubscriptionActionCmd cli.Command = cli.Command{
	Name:  "event-bus-subscription",
	Usage: ``,
	Action: func(c *cli.Context) {
		query := CommonCliQueryDSLBuilderAuthorize(c, EventBusSubscriptionSecurityModel)
		CliReactivePipeHandler(query, EventBusSubscriptionActionImp)
	},
}
var ListCapabilitiesSecurityModel *SecurityModel = nil

type listCapabilitiesActionImpSig func(
	q QueryDSL) ([]string,
	*IError,
)

var ListCapabilitiesActionImp listCapabilitiesActionImpSig

func ListCapabilitiesActionFn(
	q QueryDSL,
) (
	[]string,
	*IError,
) {
	if ListCapabilitiesActionImp == nil {
		return nil, nil
	}
	return ListCapabilitiesActionImp(q)
}

var ListCapabilitiesActionCmd cli.Command = cli.Command{
	Name:  "list",
	Usage: `Lists all of the capabilities in database as a array of string as root access`,
	Action: func(c *cli.Context) {
		query := CommonCliQueryDSLBuilderAuthorize(c, ListCapabilitiesSecurityModel)
		result, err := ListCapabilitiesActionFn(query)
		HandleActionInCli(c, result, err, map[string]map[string]string{})
	},
}
var CapabilitiesTreeSecurityModel = &SecurityModel{
	ActionRequires: []PermissionInfo{
		{
			CompleteKey: "root.manage.fireback.capability.query",
		},
	},
	ResolveStrategy: "workspace",
}

type CapabilitiesTreeActionResDto struct {
	Capabilities       []*CapabilityEntity `json:"capabilities" xml:"capabilities" yaml:"capabilities"    gorm:"many2many:_capabilities;foreignKey:UniqueId;references:UniqueId"      `
	CapabilitiesListId []string            `json:"capabilitiesListId" yaml:"capabilitiesListId" xml:"capabilitiesListId" gorm:"-" sql:"-"`
	Nested             []*CapabilityEntity `json:"nested" xml:"nested" yaml:"nested"    gorm:"many2many:_nested;foreignKey:UniqueId;references:UniqueId"      `
	NestedListId       []string            `json:"nestedListId" yaml:"nestedListId" xml:"nestedListId" gorm:"-" sql:"-"`
}

func (x *CapabilitiesTreeActionResDto) RootObjectName() string {
	return "Fireback"
}

type capabilitiesTreeActionImpSig func(
	q QueryDSL) (*CapabilitiesTreeActionResDto,
	*IError,
)

var CapabilitiesTreeActionImp capabilitiesTreeActionImpSig

func CapabilitiesTreeActionFn(
	q QueryDSL,
) (
	*CapabilitiesTreeActionResDto,
	*IError,
) {
	if CapabilitiesTreeActionImp == nil {
		return nil, nil
	}
	return CapabilitiesTreeActionImp(q)
}

var CapabilitiesTreeActionCmd cli.Command = cli.Command{
	Name:  "treex",
	Usage: `dLists all of the capabilities in database as a array of string as root access`,
	Action: func(c *cli.Context) {
		query := CommonCliQueryDSLBuilderAuthorize(c, CapabilitiesTreeSecurityModel)
		result, err := CapabilitiesTreeActionFn(query)
		HandleActionInCli(c, result, err, map[string]map[string]string{})
	},
}

func FirebackCustomActions() []Module3Action {
	routes := []Module3Action{
		{
			Method:        "WEBRTC",
			Url:           "/mouseposition",
			SecurityModel: MousePositionCaptureSecurityModel,
			Name:          "mousePositionCapture",
			Description:   "",
			Handlers: []gin.HandlerFunc{
				func(c *gin.Context) {
					// POST_ONE - webrtc
					HttpPostWebrtc(c, MousePositionCaptureActionFn)
				},
			},
			Format:         "POST_ONE",
			Action:         MousePositionCaptureActionFn,
			ResponseEntity: &MousePositionCaptureActionResDto{},
			Out: &Module3ActionBody{
				Entity: "MousePositionCaptureActionResDto",
			},
			RequestEntity: &MousePositionCaptureActionReqDto{},
			In: &Module3ActionBody{
				Entity: "MousePositionCaptureActionReqDto",
			},
		},
		{
			Method:        "REACTIVE",
			Url:           "/ws",
			SecurityModel: EventBusSubscriptionSecurityModel,
			Name:          "eventBusSubscription",
			Description:   "",
			Handlers: []gin.HandlerFunc{
				ReactiveSocketHandler(EventBusSubscriptionActionImp),
			},
			Format:         "REACTIVE",
			ResponseEntity: string(""),
			Out: &Module3ActionBody{
				Entity: "",
			},
		},
		{
			Method:        "",
			Url:           "/list-capabilities",
			SecurityModel: ListCapabilitiesSecurityModel,
			Name:          "listCapabilities",
			Description:   "Lists all of the capabilities in database as a array of string as root access",
			Handlers: []gin.HandlerFunc{
				func(c *gin.Context) {
					// POST_ONE -
				},
			},
			Format:         "POST_ONE",
			Action:         ListCapabilitiesActionFn,
			ResponseEntity: &OkayResponseDto{},
			Out: &Module3ActionBody{
				Entity: "OkayResponseDto",
			},
		},
		{
			Method:        "GET",
			Url:           "/capabilitiesTree",
			SecurityModel: CapabilitiesTreeSecurityModel,
			Name:          "capabilitiesTree",
			Description:   "dLists all of the capabilities in database as a array of string as root access",
			Handlers: []gin.HandlerFunc{
				func(c *gin.Context) {
					// GET_ONE - get
					HttpGetEntity(c, CapabilitiesTreeActionFn)
				},
			},
			Format:         "GET_ONE",
			Action:         CapabilitiesTreeActionFn,
			ResponseEntity: &CapabilitiesTreeActionResDto{},
			Out: &Module3ActionBody{
				Entity: "CapabilitiesTreeActionResDto",
			},
		},
	}
	return routes
}

var FirebackCustomActionsCli = []cli.Command{
	MousePositionCaptureActionCmd,
	EventBusSubscriptionActionCmd,
	ListCapabilitiesActionCmd,
	CapabilitiesTreeActionCmd,
}

// Use the actions bundle for ease and provide it to the ModuleProvider
// and it would gather all actions in the module level
var FirebackCliActionsBundle = &CliActionsBundle{
	Name:  "fireback",
	Usage: ``,
	// Here we will include entities actions, as well as module level actions
	Subcommands: cli.Commands{
		MousePositionCaptureActionCmd,
		EventBusSubscriptionActionCmd,
		ListCapabilitiesActionCmd,
		CapabilitiesTreeActionCmd,
		WebPushConfigCliFn(),
		CapabilityCliFn(),
	},
}

func GetFirebackActionsBundle() *ModuleActionsBundle {
	return &ModuleActionsBundle{
		Actions:   FirebackCustomActions(),
		CliAction: FirebackCliActionsBundle,
	}
}
func GetFirebackActionsCli() []cli.Command {
	return FirebackCustomActionsCli
}
